import { Directive, EventEmitter, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "./ngx-gp-autocomplete.service";
import * as i2 from "@googlemaps/js-api-loader";
export class NgxGpAutocompleteDirective {
    constructor(el, ngxGpAutocompleteService, loader, ngZone) {
        this.el = el;
        this.ngxGpAutocompleteService = ngxGpAutocompleteService;
        this.loader = loader;
        this.ngZone = ngZone;
        this.onAddressChange = new EventEmitter();
    }
    ngAfterViewInit() {
        if (!this.options) {
            this.options = this.ngxGpAutocompleteService.getOptions();
        }
        if (this.ngxGpAutocompleteService.getGooglePersistenceCheck()) {
            if (!this.isGoogleLibExists()) {
                this.loader.importLibrary("places").then(() => this.initialize(), console.error);
            }
        }
        else {
            this.loader.importLibrary("places").then(() => this.initialize(), console.error);
        }
    }
    isGoogleLibExists() {
        return !(!google || !google.maps || !google.maps.places);
    }
    initialize() {
        if (!this.isGoogleLibExists())
            throw new Error("Google maps library can not be found");
        this.autocomplete = new google.maps.places.Autocomplete(this.el.nativeElement, this.options);
        if (!this.autocomplete)
            throw new Error("Autocomplete is not initialized");
        if (!this.autocomplete.addListener != null) { // Check to bypass https://github.com/angular-ui/angular-google-maps/issues/270
            this.eventListener = this.autocomplete.addListener('place_changed', () => {
                this.handleChangeEvent();
            });
        }
        this.el.nativeElement.addEventListener('keydown', (event) => {
            if (!event.key) {
                return;
            }
            let key = event.key.toLowerCase();
            if (key == 'enter' && event.target === this.el.nativeElement) {
                event.preventDefault();
                event.stopPropagation();
            }
        });
        // according to https://gist.github.com/schoenobates/ef578a02ac8ab6726487
        if (window && window.navigator && window.navigator.userAgent && navigator.userAgent.match(/(iPad|iPhone|iPod)/g)) {
            setTimeout(() => {
                let containers = document.getElementsByClassName('pac-container');
                if (containers) {
                    let arr = Array.from(containers);
                    if (arr) {
                        for (let container of arr) {
                            if (!container)
                                continue;
                            container.addEventListener('touchend', (e) => {
                                e.stopImmediatePropagation();
                            });
                        }
                    }
                }
            }, 500);
        }
    }
    reset() {
        this.autocomplete.setComponentRestrictions(this.options.componentRestrictions);
        this.autocomplete.setTypes(this.options.types);
    }
    handleChangeEvent() {
        this.ngZone.run(() => {
            this.place = this.autocomplete.getPlace();
            if (this.place) {
                this.onAddressChange.emit(this.place);
            }
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.6", ngImport: i0, type: NgxGpAutocompleteDirective, deps: [{ token: i0.ElementRef }, { token: i1.NgxGpAutocompleteService }, { token: i2.Loader }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.6", type: NgxGpAutocompleteDirective, selector: "[ngx-gp-autocomplete]", inputs: { options: "options" }, outputs: { onAddressChange: "onAddressChange" }, exportAs: ["ngx-places"], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.6", ngImport: i0, type: NgxGpAutocompleteDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[ngx-gp-autocomplete]',
                    exportAs: 'ngx-places'
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.NgxGpAutocompleteService }, { type: i2.Loader }, { type: i0.NgZone }]; }, propDecorators: { options: [{
                type: Input
            }], onAddressChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWdwLWF1dG9jb21wbGV0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtZ3AtYXV0b2NvbXBsZXRlL3NyYy9saWIvbmd4LWdwLWF1dG9jb21wbGV0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQixTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7QUFXMUcsTUFBTSxPQUFPLDBCQUEwQjtJQU9yQyxZQUNTLEVBQWMsRUFDYix3QkFBa0QsRUFDbEQsTUFBYyxFQUNkLE1BQWM7UUFIZixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2IsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQVRkLG9CQUFlLEdBQWlELElBQUksWUFBWSxFQUFFLENBQUM7SUFXN0YsQ0FBQztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUMzRDtRQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLHlCQUF5QixFQUFFLEVBQUU7WUFDN0QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFFO2dCQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNsRjtTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMs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SUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUUxQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ3ZDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOzhHQWxHVSwwQkFBMEI7a0dBQTFCLDBCQUEwQjs7MkZBQTFCLDBCQUEwQjtrQkFKdEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsdUJBQXVCO29CQUNqQyxRQUFRLEVBQUUsWUFBWTtpQkFDdkI7a0xBRVUsT0FBTztzQkFBZixLQUFLO2dCQUNJLGVBQWU7c0JBQXhCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE5nWm9uZSwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2FkZXIgfSBmcm9tICdAZ29vZ2xlbWFwcy9qcy1hcGktbG9hZGVyJztcbmltcG9ydCB7IE5neEdwQXV0b2NvbXBsZXRlT3B0aW9ucyB9IGZyb20gJy4vbmd4LWdwLWF1dG9jb21wbGV0ZS1vcHRpb25zJztcbmltcG9ydCB7IE5neEdwQXV0b2NvbXBsZXRlU2VydmljZSB9IGZyb20gJy4vbmd4LWdwLWF1dG9jb21wbGV0ZS5zZXJ2aWNlJztcblxuZGVjbGFyZSBsZXQgZ29vZ2xlOiBhbnk7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tuZ3gtZ3AtYXV0b2NvbXBsZXRlXScsXG4gIGV4cG9ydEFzOiAnbmd4LXBsYWNlcydcbn0pXG5leHBvcnQgY2xhc3MgTmd4R3BBdXRvY29tcGxldGVEaXJlY3RpdmUgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgQElucHV0KCkgb3B0aW9uczogTmd4R3BBdXRvY29tcGxldGVPcHRpb25zO1xuICBAT3V0cHV0KCkgb25BZGRyZXNzQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Z29vZ2xlLm1hcHMucGxhY2VzLlBsYWNlUmVzdWx0PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgcHVibGljIHBsYWNlOiBnb29nbGUubWFwcy5wbGFjZXMuUGxhY2VSZXN1bHQ7XG4gIHByaXZhdGUgZXZlbnRMaXN0ZW5lcjogYW55O1xuICBwcml2YXRlIGF1dG9jb21wbGV0ZTogZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBuZ3hHcEF1dG9jb21wbGV0ZVNlcnZpY2U6IE5neEdwQXV0b2NvbXBsZXRlU2VydmljZSxcbiAgICBwcml2YXRlIGxvYWRlcjogTG9hZGVyLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICkge1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5vcHRpb25zKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLm5neEdwQXV0b2NvbXBsZXRlU2VydmljZS5nZXRPcHRpb25zKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubmd4R3BBdXRvY29tcGxldGVTZXJ2aWNlLmdldEdvb2dsZVBlcnNpc3RlbmNlQ2hlY2soKSkge1xuICAgICAgaWYgKCF0aGlzLmlzR29vZ2xlTGliRXhpc3RzKCkpIHtcbiAgICAgICAgdGhpcy5sb2FkZXIuaW1wb3J0TGlicmFyeShcInBsYWNlc1wiKS50aGVuKCgpID0+IHRoaXMuaW5pdGlhbGl6ZSgpLCBjb25zb2xlLmVycm9yKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2FkZXIuaW1wb3J0TGlicmFyeShcInBsYWNlc1wiKS50aGVuKCgpID0+IHRoaXMuaW5pdGlhbGl6ZSgpLCBjb25zb2xlLmVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzR29vZ2xlTGliRXhpc3RzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhKCFnb29nbGUgfHwgIWdvb2dsZS5tYXBzIHx8ICFnb29nbGUubWFwcy5wbGFjZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc0dvb2dsZUxpYkV4aXN0cygpKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR29vZ2xlIG1hcHMgbGlicmFyeSBjYW4gbm90IGJlIGZvdW5kXCIpO1xuXG4gICAgdGhpcy5hdXRvY29tcGxldGUgPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIHRoaXMub3B0aW9ucyk7XG5cbiAgICBpZiAoIXRoaXMuYXV0b2NvbXBsZXRlKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXV0b2NvbXBsZXRlIGlzIG5vdCBpbml0aWFsaXplZFwiKTtcblxuICAgIGlmICghdGhpcy5hdXRvY29tcGxldGUuYWRkTGlzdGVuZXIgIT0gbnVsbCkgeyAvLyBDaGVjayB0byBieXBhc3MgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXItdWkvYW5ndWxhci1nb29nbGUtbWFwcy9pc3N1ZXMvMjcwXG4gICAgICB0aGlzLmV2ZW50TGlzdGVuZXIgPSB0aGlzLmF1dG9jb21wbGV0ZS5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVDaGFuZ2VFdmVudCgpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgaWYgKCFldmVudC5rZXkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQga2V5ID0gZXZlbnQua2V5LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIGlmIChrZXkgPT0gJ2VudGVyJyAmJiBldmVudC50YXJnZXQgPT09IHRoaXMuZWwubmF0aXZlRWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGFjY29yZGluZyB0byBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9zY2hvZW5vYmF0ZXMvZWY1NzhhMDJhYzhhYjY3MjY0ODdcbiAgICBpZiAod2luZG93ICYmIHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvKGlQYWR8aVBob25lfGlQb2QpL2cpKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgbGV0IGNvbnRhaW5lcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYWMtY29udGFpbmVyJyk7XG5cbiAgICAgICAgaWYgKGNvbnRhaW5lcnMpIHtcbiAgICAgICAgICBsZXQgYXJyID0gQXJyYXkuZnJvbShjb250YWluZXJzKTtcblxuICAgICAgICAgIGlmIChhcnIpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGNvbnRhaW5lciBvZiBhcnIpIHtcbiAgICAgICAgICAgICAgaWYgKCFjb250YWluZXIpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgNTAwKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5hdXRvY29tcGxldGUuc2V0Q29tcG9uZW50UmVzdHJpY3Rpb25zKHRoaXMub3B0aW9ucy5jb21wb25lbnRSZXN0cmljdGlvbnMpO1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlLnNldFR5cGVzKHRoaXMub3B0aW9ucy50eXBlcyk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUNoYW5nZUV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLnBsYWNlID0gdGhpcy5hdXRvY29tcGxldGUuZ2V0UGxhY2UoKTtcblxuICAgICAgaWYgKHRoaXMucGxhY2UpIHtcbiAgICAgICAgdGhpcy5vbkFkZHJlc3NDaGFuZ2UuZW1pdCh0aGlzLnBsYWNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19