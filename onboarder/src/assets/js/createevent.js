function preview(imageId) {
  var frame = document.getElementById(imageId);
  frame.src = URL.createObjectURL(event.target.files[0]);
}

function clearImage(inputId, imageId) {
  var input = document.getElementById(inputId);
  input.value = null;
  var frame = document.getElementById(imageId);
  frame.src = "";
}

$(document).ready(function(){

  var current_fs, next_fs, previous_fs; //fieldsets
  
  
  var opacity;
  var current = 1;
  var steps = $("fieldset").length;
  
  setProgressBar(current);
  

  $(".next").click(function() {
      var formData = getFormData();
      current_fs = $(this).parent();
      next_fs = $("fieldset").eq(current);

      // Add Class Active
      $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

      // Validate the current step before proceeding
      if (current === 1 && !validateStep1(formData)) {
          return false;
      } else if (current === 2 && !validateStep2(formData)) {
          return false;
      } else if (current === 3 && !validateStep3(formData)) {
          return false;
      }

      // Show the next fieldset
      next_fs.show();

      current_fs.animate({opacity: 0}, {
          step: function(now) {
              // for making fieldset appear animation
              opacity = 1 - now;
              
              current_fs.css({
                  'display': 'none',
                  'position': 'relative'
              });
              next_fs.css({'opacity': opacity});
          },
          duration: 500
      });

      setProgressBar(++current);
  });

  $(".success").click(function(){
      
      current_fs = $(this).parent();
      next_fs = $(this).parent().next();
      
      //Add Class Active
      $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
      
      //show the next fieldset
      document.addEventListener('postRequestSuccess', function ()
      {
          next_fs.show();

          //hide the current fieldset with style
          current_fs.animate({opacity: 0}, {
              step: function(now) {
                  // for making fieldset appear animation
                  opacity = 1 - now;
                  
                  current_fs.css({
                      'display': 'none',
                      'position': 'relative'
                  });
                  next_fs.css({'opacity': opacity});
              },
              duration: 500
          });
          setProgressBar(++current);
      }); 
  });


  $(".previous").click(function(){

      current_fs = $(this).parent();
      previous_fs = $(this).parent().prev();
      
      //Remove class active
      $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
      
      //show the previous fieldset
      previous_fs.show();
      
      //hide the current fieldset with style
      current_fs.animate({opacity: 0}, {
          step: function(now) {
              // for making fieldset appear animation
              opacity = 1 - now;
              
              current_fs.css({
                  'display': 'none',
                  'position': 'relative'
              });
              previous_fs.css({'opacity': opacity});
          },
          duration: 500
      });
      setProgressBar(--current);
  });

  function setProgressBar(curStep){
      var percent = parseFloat(100 / steps) * curStep;
      percent = percent.toFixed();
      $(".progress-bar")
      .css("width",percent+"%")
  }

  $(".submit").click(function(){
      return false;
  });

  // Currency sa Price Settins

  $("input[data-type='currency']").on({
      keyup: function() {
          formatCurrency($(this));
      },
      blur: function() { 
          formatCurrency($(this), "blur");
      }
  });


  function formatNumber(n) {
      // format number 1000000 to 1,234,567
      return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
  }


  function formatCurrency(input, blur) {
      // appends $ to value, validates decimal side
      // and puts cursor back in right position.
      
      // get input value
      var input_val = input.val();
      
      // don't validate empty input
      if (input_val === "") { return; }
      
      // original length
      var original_len = input_val.length;

      // initial caret position 
      var caret_pos = input.prop("selectionStart");
          
      // check for decimal
      if (input_val.indexOf(".") >= 0) {

          // get position of first decimal
          // this prevents multiple decimals from
          // being entered
          var decimal_pos = input_val.indexOf(".");

          // split number by decimal point
          var left_side = input_val.substring(0, decimal_pos);
          var right_side = input_val.substring(decimal_pos);

          // add commas to left side of number
          left_side = formatNumber(left_side);

          // validate right side
          right_side = formatNumber(right_side);
          
          // On blur make sure 2 numbers after decimal
          if (blur === "blur") {
              right_side += "00";
          }
          
          // Limit decimal to only 2 digits
          right_side = right_side.substring(0, 2);

          // join number by .
          input_val = "₱" + left_side + "." + right_side;

      } else {
          // no decimal entered
          // add commas to number
          // remove all non-digits
          input_val = formatNumber(input_val);
          input_val = "₱" + input_val;
          
          // final formatting
          if (blur === "blur") {
              input_val += ".00";
          }
      }
      
      // send updated string to input
      input.val(input_val);

      // put caret back in the right position
      var updated_len = input_val.length;
      caret_pos = updated_len - original_len + caret_pos;
      input[0].setSelectionRange(caret_pos, caret_pos);
  }

  function getFormData() {
      var formData = {
          eventTitle: $("#eventTitle").val(),
          eventDesc: $("#eventDesc").val(),
          eventDate: $("#eventDate").val(),
          eventTime: $("#eventTime").val(),
          location: $("#location").val(),
          meetingURL: $("#meetingURL").val(),
          eventSeats: $("#eventSeats").val(),
          eventPrice: $("#eventPrice").val(),
          eventPaymentDetails: $("#eventPaymentDetails")
      };
      return formData;
  }

  function validateStep1(formData){
    const event = getFormData(formData);
    const eventDate = new Date(event.eventDate); // Corrected new Date()
    const currentDate = new Date();
    
    if (event.eventTitle == '' || event.eventDesc == '' ||
        event.eventDate == '' || event.eventTime == '') {
        Swal.fire('Error', 'Please fill out all fields.', 'error');
        return false;
    } if (eventDate < currentDate) {
      Swal.fire("Error", "Please select a future date for the event", "error");
      return false;
    } 
    else {
        return true;
    }
}

  function validateStep2(){
      return true;
  }

  function validateStep3(formData){
      const event = getFormData(formData);

      if(event.eventSeats == '' ||
          event.eventPrice == '' ||
          event.eventPaymentDetails == '') {
          Swal.fire("Error", "Please fill up all the required fields in Step 3", "error");
          return false;
      }
      return true;
  }

  function validateStep4(){
      return true;
  }

});
